# 迁移页面更新说明

## ✨ 新增功能

### 日期更新功能

在标签迁移页面的"步骤 2: 当前标签状态"中，新增了**日期更新功能**：

#### 功能说明
- 📅 **目标数据**: 2025年12月26日和27日添加的所有 Prompt
- ⏰ **更新方式**: 将创建时间往前推 **30 天**（1个月）
- 🎯 **目的**: 将这些数据的时间调整为1个月前

#### 使用方法

1. **访问迁移页面**
   ```
   https://your-domain.vercel.app/admin/migrate-tags
   ```

2. **输入 IMPORT_SECRET**
   - 在第一步输入密钥
   - 点击"查看当前状态"

3. **执行日期更新**
   - 在"步骤 2"页面中，找到"日期更新功能"区域
   - 点击"执行日期更新"按钮
   - 等待处理完成

4. **查看更新结果**
   - 弹窗显示更新统计：
     - 找到多少条记录
     - 成功更新多少条
     - 失败多少条
   - 显示原始日期范围和更新后的日期范围
   - 显示前10条更新示例

#### 界面说明

```
┌─────────────────────────────────────┐
│  📅 日期更新功能                     │
│                                     │
│  将 2025年12月26日 和 27日 添加的   │
│  所有数据的创建时间往前推 30 天      │
│                                     │
│  [ 📅 执行日期更新 ]                │
└─────────────────────────────────────┘
```

#### 更新结果弹窗

```
┌─────────────────────────────────────┐
│  📅 日期更新完成               [X]  │
├─────────────────────────────────────┤
│  找到记录: 45                       │
│  更新成功: 45                       │
│  失败: 0                            │
├─────────────────────────────────────┤
│  日期范围：                         │
│  原始范围: 2025-12-26 ~ 2025-12-27 │
│  更新为: 2025-11-26 ~ 2025-11-27   │
├─────────────────────────────────────┤
│  更新示例（前10条）：               │
│  • Prompt 标题                      │
│    2025-12-26 10:30 → 2025-11-26.. │
│  ...                                │
├─────────────────────────────────────┤
│  [ 关闭 ]                           │
└─────────────────────────────────────┘
```

## 🔄 工作流程

### 完整的迁移流程

1. **输入密钥** → 验证身份
2. **查看状态** → 
   - 查看标签状态
   - **可选：执行日期更新** ← 新增
3. **生成计划** → 预览标签迁移
4. **确认执行** → 执行标签迁移
5. **查看结果** → 完成

## ⚠️ 注意事项

### 日期更新

- ⚠️ **不可逆操作**: 日期更新后无法自动恢复
- ✅ **独立功能**: 可以只执行日期更新，不执行标签迁移
- ✅ **自动识别**: 自动识别12月26日和27日的数据
- ✅ **批量处理**: 一次性处理所有匹配的记录

### 建议执行顺序

1. **先执行日期更新** - 如果需要调整数据时间
2. **再执行标签迁移** - 调整标签体系

或者分开执行，互不影响。

## 🎯 技术细节

### API 端点
```
POST /api/update-dates
```

**请求体：**
```json
{
  "secret": "YOUR_IMPORT_SECRET"
}
```

**响应示例：**
```json
{
  "success": true,
  "data": {
    "message": "日期更新完成",
    "totalFound": 45,
    "successCount": 45,
    "errorCount": 0,
    "dateRange": {
      "original": {
        "from": "2025-12-26T00:00:00.000Z",
        "to": "2025-12-27T23:59:59.999Z"
      },
      "updated": {
        "from": "2025-11-26T00:00:00.000Z",
        "to": "2025-11-27T23:59:59.999Z"
      }
    },
    "samples": [
      {
        "id": "xxx",
        "effect": "Prompt 标题",
        "oldDate": "2025-12-26T10:30:00.000Z",
        "newDate": "2025-11-26T10:30:00.000Z"
      }
    ]
  }
}
```

### 日期计算逻辑

```typescript
// 原始创建时间
const originalDate = new Date('2025-12-26T10:30:00.000Z');

// 往前推 30 天
const newDate = new Date(originalDate);
newDate.setDate(newDate.getDate() - 30);

// 结果: 2025-11-26T10:30:00.000Z
```

## 📊 使用场景

### 为什么需要日期更新？

1. **数据测试**: 将测试数据的时间调整到过去
2. **内容规划**: 调整内容发布的时间顺序
3. **数据迁移**: 从其他系统迁移时需要调整时间
4. **批量调整**: 需要将某个时间段的数据统一调整

### 实际应用

如果您在 12月26日和27日 批量导入了一批数据，但希望这些数据看起来像是在 11月26日和27日 添加的，就可以使用这个功能。

## ✅ 验证结果

### 检查日期是否更新

1. **通过 API**
   ```bash
   curl https://your-domain.vercel.app/api/prompts
   ```
   查看返回的 `createdAt` 字段

2. **通过前端**
   - 访问首页
   - 按时间排序查看 Prompt
   - 确认日期已更新

3. **通过后台**
   - 访问 `/admin`
   - 查看 Prompt 列表的创建时间
   - 确认显示为更新后的时间

## 🚀 快速开始

### 只更新日期（不迁移标签）

1. 访问 `https://your-domain.vercel.app/admin/migrate-tags`
2. 输入 IMPORT_SECRET
3. 点击"查看当前状态"
4. 在"日期更新功能"区域点击"执行日期更新"
5. 查看结果弹窗
6. 完成！

### 同时执行日期更新和标签迁移

1. 访问迁移页面
2. 输入密钥，查看状态
3. **先点击"执行日期更新"** - 更新数据时间
4. **再点击"生成迁移计划"** - 继续标签迁移流程
5. 按提示完成标签迁移
6. 两个任务都完成！

## 📝 更新日志

### v1.1.0 - 2025-12-27

**新增功能：**
- ✨ 在迁移页面添加日期更新功能
- ✨ 支持将12月26日和27日的数据时间往前推30天
- ✨ 显示详细的更新结果和统计信息
- ✨ 提供更新示例预览

**改进：**
- 🎨 优化迁移页面布局
- 📚 更新相关文档

---

**文档更新**: 2025-12-27
**功能状态**: ✅ 已完成，可以使用
