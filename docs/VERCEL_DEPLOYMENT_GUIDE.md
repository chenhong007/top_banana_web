# 🎯 标签迁移 - Vercel 部署说明

## ✅ 已完成的工作

### 1. 创建了可视化迁移页面
- 📍 路径：`/admin/migrate-tags`
- 🔐 需要 IMPORT_SECRET 认证
- 🎨 美观的 UI 界面
- 📊 实时显示迁移进度

### 2. 集成到管理后台
- 在后台导航栏添加了"标签迁移"链接
- 可以从后台直接访问

### 3. 创建了 API 端点
- `GET /api/migrate-tags` - 查看状态
- `POST /api/migrate-tags` - 执行迁移

## 🚀 部署步骤

### 第 1 步：提交代码到 Git

```bash
# 添加所有更改
git add .

# 提交更改
git commit -m "feat: 添加标签迁移功能"

# 推送到远程仓库
git push origin main
```

### 第 2 步：等待 Vercel 自动部署

1. 推送后，Vercel 会自动开始构建
2. 访问 [Vercel Dashboard](https://vercel.com/dashboard)
3. 查看部署状态
4. 等待部署完成（通常 2-5 分钟）

### 第 3 步：检查环境变量

在 Vercel 项目中确保已配置：

```
IMPORT_SECRET=your-secure-secret-here
```

**位置：** Vercel Dashboard → Your Project → Settings → Environment Variables

如果没有，添加一个：
```bash
# 生成安全密钥
openssl rand -hex 32
# 或
node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
```

### 第 4 步：访问迁移页面

部署完成后，访问：

```
https://your-domain.vercel.app/admin/migrate-tags
```

或者从后台进入：

```
https://your-domain.vercel.app/admin
→ 点击顶部"标签迁移"按钮
```

## 📋 使用迁移页面

### 步骤 1: 输入密钥

1. 打开迁移页面
2. 输入 `IMPORT_SECRET` 的值
3. 点击"查看当前状态"

### 步骤 2: 查看状态

- 查看当前有多少标签
- 查看有多少需要迁移
- 预览标签映射关系

### 步骤 3: 生成计划

1. 点击"生成迁移计划"
2. 查看详细的迁移计划
3. 确认每个标签的映射关系

### 步骤 4: 确认执行

1. 点击"确认执行迁移"
2. 最终确认（不可撤销）
3. 点击"确认执行迁移"

### 步骤 5: 查看结果

- 查看迁移统计
- 查看最终标签列表
- 验证迁移是否成功

## 🎨 页面截图说明

### 步骤 1 - 输入密钥
```
┌────────────────────────────────────┐
│     🗄️  标签迁移工具               │
│  将英文标签翻译成中文并合并近义词     │
├────────────────────────────────────┤
│  IMPORT_SECRET                     │
│  [••••••••••••••••••••••••••]      │
│                                    │
│  [ 查看当前状态 ]                  │
└────────────────────────────────────┘
```

### 步骤 2 - 显示状态
```
┌────────────────────────────────────┐
│  📊 当前标签数: 45                 │
│  🎯 目标标签数: 20                 │
│  🔄 需要迁移: 37                   │
│  ✅ 已是中文: 8                    │
├────────────────────────────────────┤
│  标签映射预览:                     │
│  3D设计 (15) → 设计                │
│  Logo设计 (12) → 设计              │
│  ...                              │
├────────────────────────────────────┤
│  [ 返回 ]  [ 生成迁移计划 ]        │
└────────────────────────────────────┘
```

### 步骤 3 - 预览计划
```
┌────────────────────────────────────┐
│  ⚠️ 此操作将永久修改数据库           │
├────────────────────────────────────┤
│  迁移前: 45   保持: 8              │
│  需合并: 37   迁移后: 20           │
├────────────────────────────────────┤
│  迁移详情:                         │
│  3D设计 (15) [merge] → 设计        │
│  UI设计 (12) [merge] → 设计        │
│  ...                              │
├────────────────────────────────────┤
│  [ 返回 ]  [ 确认执行迁移 ]        │
└────────────────────────────────────┘
```

### 步骤 4 - 确认
```
┌────────────────────────────────────┐
│  🚨 危险操作确认                    │
│  • 此操作将永久删除旧标签            │
│  • 此操作不可撤销                   │
│  • 请确保已备份数据库               │
├────────────────────────────────────┤
│  [ 我再想想 ]  [ 确认执行迁移 ]    │
└────────────────────────────────────┘
```

### 步骤 5 - 完成
```
┌────────────────────────────────────┐
│         ✅ 迁移完成！               │
│    标签已成功迁移到中文标签体系      │
├────────────────────────────────────┤
│  迁移前: 45   迁移后: 20           │
│  成功: 37     失败: 0              │
├────────────────────────────────────┤
│  最终标签列表:                     │
│  设计: 120   艺术: 85              │
│  卡通: 45    角色: 38              │
│  ...                              │
├────────────────────────────────────┤
│  [ 完成 ]                          │
└────────────────────────────────────┘
```

## ⚠️ 重要提示

### 在执行前

- ✅ 确保已提交代码并部署到 Vercel
- ✅ 确保 IMPORT_SECRET 已在 Vercel 中配置
- ✅ 先使用预览功能查看迁移计划
- ✅ 在低峰时段执行（推荐）
- ⚠️ 数据库备份（可选但推荐）

### 执行后

- 刷新前端页面查看新标签
- 清除浏览器缓存
- 验证标签筛选功能
- 验证后台标签输入

## 🔍 验证结果

### 1. 检查 API
```bash
curl https://your-domain.vercel.app/api/tags
```

应该返回 20 个中文标签。

### 2. 检查前端
访问首页，应该看到中文标签按钮：
```
全部 | 设计 | 艺术 | 卡通 | 角色 | ...
```

### 3. 检查后台
在后台添加 Prompt 时，标签下拉列表显示中文标签。

## 📱 移动端支持

迁移页面完全响应式，支持：
- ✅ 桌面浏览器
- ✅ 平板设备
- ✅ 手机浏览器

可以在任何设备上执行迁移。

## 🐛 故障排查

### 问题 1: 找不到页面

**症状：** 访问 `/admin/migrate-tags` 返回 404

**解决：**
1. 确认代码已推送到 Git
2. 确认 Vercel 已完成部署
3. 检查构建日志是否有错误

### 问题 2: 认证失败

**症状：** 提示"认证失败"

**解决：**
1. 检查输入的密钥是否正确
2. 确认 Vercel 环境变量已配置
3. 重新部署项目使环境变量生效

### 问题 3: 迁移超时

**症状：** 执行时超时

**解决：**
- API 已设置最大执行时间 300 秒（5分钟）
- 如果标签特别多，联系支持

### 问题 4: 前端未更新

**症状：** 迁移后前端仍显示旧标签

**解决：**
1. 硬刷新页面（Ctrl+Shift+R）
2. 清除浏览器缓存
3. 等待 CDN 缓存更新（几分钟）

## 📞 需要帮助？

查看 Vercel 函数日志：
```
Vercel Dashboard 
→ Your Project 
→ Deployments 
→ [Latest] 
→ Function Logs
```

搜索 `[MigrateTags]` 查看详细日志。

## 🎉 完成！

迁移完成后，您的系统将使用统一的 20 个中文核心标签：

```
设计  艺术  卡通  角色  风景  人物  动物  自然  美食  商业
创意  科幻  奇幻  游戏  时尚  极简  复古  未来  数据  代码
```

所有前端和后台功能将自动适配新的标签体系！

---

**准备好了？推送代码到 Git，然后访问：**
```
https://your-domain.vercel.app/admin/migrate-tags
```
